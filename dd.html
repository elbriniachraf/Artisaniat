

<style>
	.status-group {
    margin-top: 10px;
    padding: 10px;
    border: 1px solid #ddd;
    border-radius: 5px;
    background-color: #f9f9f9;
    display: flex;
    flex-direction: row;
	justify-content: space-around;
    gap: 5px;
}

.status-group div {
    display: flex;
    flex-direction: column;

    align-items: center;
    gap: 10px;
}

.status-group .fas {
    font-size: 18px;
}

.status-group .text-success {
    color: #28a745;
    font-weight: bold;
}

.status-group .text-danger {
    color: #dc3545;
    font-weight: bold;
}

.list-group-item {
    padding: 15px;
    background-color: #fff;
    border: 1px solid #ddd;
    border-radius: 5px;
    margin-bottom: 10px;
    box-shadow: 0px 2px 5px rgba(0, 0, 0, 0.1);
}

	body {
		font-family: 'Arial', sans-serif;
		background-color: #f7f7f7;
	}
	.navbar {
		background-color: #007bff;
		color: white;
	}
	

	
	.overlayy {
	  pointer-events: none; /* Empêche les interactions */
	  opacity: 0.5; /* Rend la section plus claire */
	  background-color: rgba(0, 0, 0, 0.1); /* Ajoute une superposition */
	}
	
	.table {
		background-color: #fff;
		box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.1);
		border-radius: 8px;
	}
	
	
	.awesome-table {
		width: 100%;
		border-collapse: collapse;
		box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
		background-color: #fff;
	  }
	

/* Filtre */
.filter-tab {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 10px;
  margin-top: 20px;
  background: #f8f9fa;
  border-radius: 8px;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
}

.filter-tab select {
  padding: 5px 10px;
  border: 1px solid #ddd;
  border-radius: 5px;
  background: #fff;
  color: #333;
}

.filter-tab select:focus {
  outline: none;
  border-color: #007bff;
}
	  .awesome-table thead {
		background-color: #007bff;
		color: white;
		text-align: left;
	  }
	
	  .awesome-table th, .awesome-table td {
		padding: 10px;
		border: 1px solid #ddd;
	  }
	
	  .awesome-table tbody tr:hover {
		background-color: #f1f1f1;
	  }
	
	  .awesome-table button {
		margin-right: 5px;
	  }
	.form-container {
		margin-top: 20px;
		background-color: #fff;
		padding: 20px;
		box-shadow: 0px 4px 15px rgba(0, 0, 0, 0.1);
		border-radius: 8px;
	}
	.form-container input, .form-container select {
		margin-bottom: 15px;
	}
	.btn-add {
		background-color: #007bff;
		color: white;
	}
	
	.bg-blue{
		background-color: #007bff;
	
	}
	.btn-edit, .btn-delete {
		background-color: #f39c12;
		color: white;
	}
	.btn-delete {
		background-color: #e74c3c;
	}
	.form-container h3 {
		margin-bottom: 20px;
	}
	</style> 
	<div class="modal-header modal-header-primary">
	  <div class="pull-right" style="position: absolute;
	  right: 2.4em;
	  top: 2.4em;
	">
		<button type="button" class="btn btn-danger" ng-click="cancel()">
		  <i class="fa fa-close"></i>
		</button>
	  </div>
	  <h3 class="modal-title">
		Gestion des palettes Europe ==> {{order.CodeClient}}
		
	  </h3>
	</div>
	
	<div class="container mt-4" style="width: 100%;">

	<style>
	  body {
		font-family: 'Arial', sans-serif;
		background-color: #f7f7f7;
	  }
	  .navbar {
		background-color: #007bff;
		color: white;
	  }
	  
	  .overlayy {
		pointer-events: none; /* Empêche les interactions */
		opacity: 0.5; /* Rend la section plus claire */
		background-color: rgba(0, 0, 0, 0.1); /* Ajoute une superposition */
	  }
	  
	  .table {
		background-color: #fff;
		box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.1);
		border-radius: 8px;
	  }
	  
	  
	  .awesome-table {
		  width: 100%;
		  border-collapse: collapse;
		  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
		  background-color: #fff;
		}
	  
		.awesome-table thead {
		  background-color: #007bff;
		  color: white;
		  text-align: left;
		}
	  
		.awesome-table th, .awesome-table td {
		  padding: 10px;
		  border: 1px solid #ddd;
		}
	  
		.awesome-table tbody tr:hover {
		  background-color: #f1f1f1;
		}
	  
		.awesome-table button {
		  margin-right: 5px;
		}
	  .form-container {
		margin-top: 20px;
		background-color: #fff;
		padding: 20px;
		box-shadow: 0px 4px 15px rgba(0, 0, 0, 0.1);
		border-radius: 8px;
	  }
	  .form-container input, .form-container select {
		margin-bottom: 15px;
	  }
	  .btn-add {
		background-color: #007bff;
		color: white;
	  }
	  
	  .bg-blue{
		background-color: #007bff;
	  
	  }
	  .btn-edit, .btn-delete {
		background-color: #f39c12;
		color: white;
	  }
	  .btn-delete {
		background-color: #e74c3c;
	  }
	  .form-container h3 {
		margin-bottom: 20px;
	  }
	
	  body {
	  font-family: 'Poppins', sans-serif;
	  background-color: #f5f8fd;
	  color: #2c3e50;
	}
	
	.palette-actions {
	  margin-top: 30px;
	  padding: 20px;
	}
	
	.action-section {
	  padding: 20px;
	}
	
	.card {
	  width: 100% !important;
	  border: none;
	  border-radius: 16px;
	  box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
	  background: linear-gradient(145deg, #ffffff, #f0f4fb);
	  transition: transform 0.3s ease, box-shadow 0.3s ease;
	}
	
	.card:hover {
	  transform: scale(1.02);
	  box-shadow: 0 12px 30px rgba(0, 0, 0, 0.2);
	}
	
	.card-header {
	  background-color: #1f3c88;
	  color: #ffffff;
	  padding: 15px;
	  border-radius: 16px 16px 0 0;
	  text-align: center;
	  font-size: 18px;
	  font-weight: 600;
	}
	
	.card-body {
	  padding: 20px;
	  gap: 20px !important;
	  display: block !important;
	}
	
	.description {
	  font-size: 14px;
	  color: #5c6f88;
	  margin-bottom: 20px;
	}
	
	.form-group label {
	  font-weight: 500;
	  color: #34495e;
	  margin-bottom: 10px;
	  display: block;
	}
	
	.input-styled {
	  border: 1px solid #dcdfe3;
	  border-radius: 10px;
	  padding: 10px 15px;
	  font-size: 14px;
	  transition: border-color 0.3s ease;
	}
	
	.input-styled:focus {
	  border-color: #1f3c88;
	  outline: none;
	  box-shadow: 0 0 5px rgba(31, 60, 136, 0.5);
	}
	
	.styled-button {
	  display: flex;
	  align-items: center;
	  justify-content: center;
	  gap: 8px;
	  width: 100%;
	  padding: 12px;
	  font-size: 16px;
	  font-weight: bold;
	  border-radius: 8px;
	  transition: background-color 0.3s ease, transform 0.2s ease;
	}
	
	.btn-primary {
	  background-color: #1f3c88;
	  color: #ffffff;
	  border: none;
	}
	
	.btn-primary:hover {
	  background-color: #1d2f72;
	  transform: translateY(-2px);
	}
	
	.btn-success {
	  background-color: #27ae60;
	  color: #ffffff;
	  border: none;
	}
	
	.btn-success:hover {
	  background-color: #1e8449;
	  transform: translateY(-2px);
	}
	
	@media (max-width: 768px) {
	  .card-header h3 {
		font-size: 16px;
	  }
	  .description {
		font-size: 12px;
	  }
	}
	
	
	th{
	  background-color: #1f3c88 !important;
	  color: white !important;
	}
	  </style> 
	 
	  
	  <div class="container mt-4" style="width: 100%;">
	  <!-- Formulaire pour ajouter/éditer une palette -->
	  
	  <div style="display: flex;gap: 60px;align-items: center;">
		<div class="stock-section" style="display: flex; align-items: center;    justify-content: left; padding: 10px; background: #f8f9fa; border-radius: 8px; margin: 10px; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);">
			<i class="fa fa-warehouse" style="font-size: 1.5em; color: #007bff; margin-right: 10px;"></i>
			<div>
			  <p style="margin: 0; font-weight: bold; color: #333;">Palettes en stock</p>
			  <p style="margin: 0; color: #555; font-size: 1.2em;"><strong>{{ stock.initialCount || 0 }}</strong></p>
			</div>
		  </div>

		  &nbsp;

		  <div class="stock-section" style="display: flex; align-items: center;    justify-content: left; padding: 10px; background: #f8f9fa; border-radius: 8px; margin: 10px; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);">
			<i class="fa fa-warehouse" style="font-size: 1.5em; color: #007bff; margin-right: 10px;"></i>
			<div>
			  <p style="margin: 0; font-weight: bold; color: #333;">Palettes à Rendre</p>
			  <p style="margin: 0; color: #555; font-size: 1.2em;"><strong>{{ stock.palettesARendre || 0 }}</strong></p>
			</div>
		  </div>
	
		  &nbsp;
	
		  <div class="stock-section" style="display: flex; align-items: center;    justify-content: left; padding: 10px; background: #f8f9fa; border-radius: 8px; margin: 10px; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);">
			<i class="fa fa-warehouse" style="font-size: 1.5em; color: #007bff; margin-right: 10px;"></i>
			<div>
			  <p style="margin: 0; font-weight: bold; color: #333;">Palettes à Récupérer</p>
			  <p style="margin: 0; color: #555; font-size: 1.2em;"><strong>{{ stock.palettesARecuperer || 0 }}</strong></p>
			</div>
		  </div>

      &nbsp;&nbsp;
      <button 
  class="btn btn-primary" 
 ng-click="toggleHistorique()"
>
  <i 
    ng-class="afficheHistorique ? 'fas fa-eye-slash' : 'fas fa-eye'"
    style="margin-right: 8px;"
  ></i>
  {{ afficheHistorique ? 'Masquer l\'historique' : 'Afficher l\'historique' }}
</button>

	</div>
	<br>

	<style>
		.badgee {
  padding: 5px 10px;
  border-radius: 5px;
  color: white;
  font-weight: bold;
}

.badge-red {
  background-color: #ff4d4d;
}

.badge-orange {
  background-color: #ffa500;
}

.badge-green {
  background-color: #4caf50;
}

	</style>
	<table class="awesome-table" ng-if="!afficheHistorique">
		<thead>
		  <tr>
			<th rowspan="3">Dossier</th>
			<th rowspan="3">Code Client</th>
			<th rowspan="3">Nom Client</th>
			<th rowspan="3">Poids (kg)</th>
			<th rowspan="3">Metre l. (ml)</th>
			<th rowspan="3">Palette Annoncée</th>
			<th colspan="2">Enlèvement</th>
			<th colspan="2">Gestion à Quai</th>
			<th colspan="3">Enlèvement Chauffeur</th>
			<th colspan="5">Livraison Chauffeur</th>
			<th rowspan="3">Statut</th>
			<th rowspan="3">Action</th>
		  </tr>
		  <tr>
			<th>Code</th>
			<th>Nom</th>
			<th>Réceptionnée</th>
			<th>Rendue</th>
			<th>Enlevée</th>
			<th>Rendue</th>
			<th>A devoir</th>
			<th>Code</th>
			<th>Nom</th>
			<th>Chargée par Magasinier</th>
			<th>Palette Livrée</th>
			<th>Destina Rendue</th>
		  </tr>
		</thead>
		<tbody>
		  <tr ng-repeat="order in sectionData">
			<!-- Données générales -->
			<td>{{ order.NumDossier }}</td>
			<td>{{ order.CodeClient }}</td>
			<td>{{ order.NomClient }}</td>
			<td>{{ order.Poids }}</td>
			<td>{{ order.MetreLin }}</td>
			<td class="bg-blue">{{ order.palAnn }}</td>
			
			<!-- Données pour "Enlèvement" -->
			<td>{{ order.CodeEn }}</td>
			<td>{{ order.NomEn }}</td>
			
			<!-- Données pour "Gestion Quai" -->
			<td>{{ order.palettesEnleved_En_Mag }}</td>
			<td>{{ order.palettesRendus_En_Mag }}</td>
			
			<!-- Données pour "Enlèvement Chauffeur" -->
			<td>{{ order.palettesEnleved_En_Cha || 0 }}</td>
			<td>{{ order.palettesRendus_En_Cha || 0 }}</td>
			<td class="bg-green">
				<span ng-if="order.palettesEnleved_En_Mag != null && order.palettesRendus_En_Mag != null && 
							 order.palettesEnleved_En_Cha != null && order.palettesRendus_En_Cha != null">
				 {{calculateADevoir(order)}}
				</span>
				<span ng-if="order.palettesEnleved_En_Mag == null || order.palettesRendus_En_Mag == null || 
							 order.palettesEnleved_En_Cha == null || order.palettesRendus_En_Cha == null">
				  Palettes manquantes
				</span>
			  </td>
			  
			  
			
			
			<!-- Données pour "Livraison" -->
			<td>{{ order.CodeLiv }}</td>
			<td>{{ order.NomLiv }}</td>
			<td>{{ order.palettesRendus_Liv_Mag }}</td>
			<td>{{ order.palettesRendus_Liv_Cha }}</td>
			<td class="bg-red">{{ order.palLiv_returned }}</td>
	  
			<!-- Statut -->
			<td>
			  <span class="badgee"
				ng-class="{
				  'badge-red': order.statusPall === 'Non encore callée',
				  'badge-orange': order.statusPall === 'En attente de signature',
				  'badge-green': order.statusPall === 'Signée'
				}">
				{{ order.statusPall }}
			  </span>
			</td>
	  
			<!-- Actions -->
      <td>
        <button
            class="btn btn-sm"
            ng-class="{
                'btn-danger': !order.isRemetre,
                'btn-success': order.isRemetre
            }"
            ng-click="order.isRemetre ? remetre(order) : cancelRecovery(order)">
            {{ order.isRemetre ? 'Remettre' : 'Annuler la récupération' }}
        </button>
    </td>
    
		  </tr>
		</tbody>
		<tfoot>
		  <tr>
			<td colspan="5" class="footer-label">Totaux</td>
			<td>{{ getTotal('palAnn') }}</td>
			<td colspan="2"></td>
			<td>{{ getTotal('palettesEnleved_En_Mag') }}</td>
			<td>{{ getTotal('palettesRendus_En_Mag') }}</td>
			<td>{{ getTotal('palettesEnleved_En_Cha') }}</td>
			<td>{{ getTotal('palettesRendus_En_Cha') }}</td>
			<td>{{ getTotal('palettesEnleved_En_Ch_d') }}</td>
			<td colspan="2"></td>
			<td>{{ getTotal('palLiv_magasinier') }}</td>
			<td>{{ getTotal('palLiv_chauffeur') }}</td>
			<td>{{ getTotal('palLiv_returned') }}</td>
			<td colspan="2"></td>
		  </tr>
		</tfoot>
	  </table>
	  
	  

    
<!-- Section Historique -->
<div class="historique-section" ng-if="afficheHistorique" style="width: 100%;">
	<h1>Historique des palettes</h1>
  
	<!-- Filtres par onglets -->
	<div class="filter-tabs" style="display: flex; justify-content: center; gap: 20px; margin-bottom: 20px;">
	  <button 
		class="btn" 
		ng-class="activeFilter === 'all' ? 'btn-primary' : 'btn-light'" 
		ng-click="setFilter('all')"
	  >
		Tous
	  </button>
	  <button 
		class="btn" 
		ng-class="activeFilter === 'saisie' ? 'btn-primary' : 'btn-light'" 
		ng-click="setFilter('saisie')"
	  >
		Saisie
	  </button>
	  <button 
		class="btn" 
		ng-class="activeFilter === 'caler' ? 'btn-primary' : 'btn-light'" 
		ng-click="setFilter('caler')"
	  >
		Calé
	  </button>
	  <button 
		class="btn" 
		ng-class="activeFilter === 'terminer' ? 'btn-primary' : 'btn-light'" 
		ng-click="setFilter('terminer')"
	  >
		Terminé
	  </button>
	</div>
  
	<!-- Liste filtrée -->
	<div class="list-group" style="display: flex;gap: 30px;flex-wrap: wrap;">
	  <div 
		ng-repeat="item in filteredHistorique = (historique | filter:filterByStatus)" 
		class="list-group-item card-container"
		style="width: 48%;"
	  >
		<!-- Ligne supérieure -->
		<div class="card-header d-flex justify-content-between align-items-center" style="display: flex; justify-content: space-around;">
		  <span class="text-white"><strong>Date:</strong> {{ item.date }}</span>
		  <span class="text-white font-weight-bold">Palettes: {{ item.nombreDePalettes }}</span>
		  <span class="text-white font-italic">Réceptionnaire: {{ item.receptionnaire }}</span>
		</div>
  
		<!-- Adresse -->
		<div class="card-body">
		  <p style="font-weight: 900"><strong>Adresse de livraison des palettes :</strong> {{ item.intervenant.Adresse }} - {{ item.intervenant.AdresseComp }} - {{ item.intervenant.CodePostal }} {{ item.intervenant.Ville }} </p>
		</div>
  
		<!-- Statuts avec icônes -->
		<div class="status-group d-flex justify-content-between">
		  <div>
			<span>Saisie:</span>
			<i class="fas" ng-class="true ? 'fa-check-circle text-success' : 'fa-times-circle text-danger'"></i>
		  </div>
		  <div>
			<span>Calé:</span>
			<i class="fas" ng-class="item.isCaler ? 'fa-check-circle text-success' : 'fa-times-circle text-danger'"></i>
		  </div>
		  <div>
			<span>Terminé:</span>
			<i class="fas" ng-class="item.isTerminer ? 'fa-check-circle text-success' : 'fa-times-circle text-danger'"></i>
		  </div>
		</div>
  
		<!-- Boutons verticaux -->
		<div class="action-buttons d-flex flex-column align-items-end mt-3" style="position: absolute; top: 65px; right: -24px;">
		  <button ng-if="!item.isCaler" class="btn btn-warning btn-icon mb-2" ng-click="supprimerCommande(item)">
			<i class="fas fa-trash"></i>
		  </button>
		  <button ng-if="item.isCaler && !item.isTerminer" class="btn btn-primary btn-icon mb-2" ng-click="supprimerDuCamion(item)">
			<i class="fas fa-truck-loading"></i>
		  </button>
		  <button ng-if="item.isTerminer" class="btn btn-success btn-icon" ng-click="imprimerBon(item)">
			<i class="fas fa-print"></i>
		  </button>
		</div>
	  </div>
	</div>
  </div>
  
	  <div class="row palette-actions" >
		<!-- Section pour rendre les palettes -->
		<div class="col-md-8 action-section">
		  <div class="card render-card">
			<div class="card-header">
			  <h3>🔄 Créer un retour de palette</h3>
			</div>

			<div class="card-body">
			  <div class="row">
				<p class="description col-12">Indiquez combien de palettes vous souhaitez rendre. Assurez-vous que tout est correct avant de soumettre.</p>
			  </div>
	  
			  <div class="row">
			
				<div class="form-group col-md-3">
					<label for="chauffeur-recup">Code intervenant pour la dépose</label>
					<input autocomplete="nope"  id='CodeClient'  typeahead-on-select="onSelect($item, $model, $label)" ng-blur="changeCli($viewValue);" ng-change="upInpCli()" ng-focus="oldValue = ClientMin.CodeClient" type="text" ng-model="CodeInter" focus="true" placeholder="Code Interveneant" uib-typeahead="address.CodeInter for address in getCodeClient($viewValue)" typeahead-loading="loadingCodeClient" class="form-control input-sm" ui-keydown="{113:'keypressClient($event)'}"  data-nq-tooltip="" data-qo-placement="bottom-left" data-qs-title="Code Intervenant" autofocus>

				  </div>
				<div class="form-group col-md-2">
				  <label for="date-rendre">Date</label>
				  <input type="date" id="date-rendre" class="form-control input-styled">
				</div>
				<div class="form-group col-md-2">
					<label for="rendre-palettes">Nombre de palette</label>
					<input type="number" id="rendre-palettes" class="form-control input-styled" placeholder="0">
				  </div>
	
			  </div>
	  
			  <div class="row align-items-end">
			   
				<div class="col-md-2">
				  <button class="btn btn-primary styled-button btn-block" ng-click="submitRendre()">
					<i class="fas fa-undo"></i> Créer le ticket retour
				  </button>
				</div>
			  </div>
			 
			
			
			</div>
		  </div>
		</div>
	  
		<!-- Section pour récupérer les palettes -->

	  </div>
	  
	  
	  
	  
	  
	  
	 
	  </div>
	
	
	
	
	</div>